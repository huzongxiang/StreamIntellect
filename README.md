# æ™ºèƒ½è§†é¢‘åˆ†æå¹³å°åç«¯ç³»ç»Ÿ

![Python](https://img.shields.io/badge/Python-3.9%2B-blue)
![FastAPI](https://img.shields.io/badge/FastAPI-0.95%2B-green)
![OpenCV](https://img.shields.io/badge/OpenCV-4.7%2B-orange)

## é¡¹ç›®æ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯åŸºäºFastAPIæ„å»ºçš„æ™ºèƒ½è§†é¢‘åˆ†æå¹³å°åç«¯ï¼Œæä¾›è§†é¢‘æµå¤„ç†ã€è®¾å¤‡ç®¡ç†ã€ç®—æ³•éƒ¨ç½²å’Œå®æ—¶ç›‘æ§ç­‰åŠŸèƒ½ã€‚æ”¯æŒä¸å¤šç§è§†é¢‘æºï¼ˆRTSPæµã€æœ¬åœ°è§†é¢‘æ–‡ä»¶ï¼‰é›†æˆï¼Œå¹¶å¯é€šè¿‡WebSocketå®ç°å®æ—¶è§†é¢‘æµä¼ è¾“ã€‚

## ä¸»è¦åŠŸèƒ½

### æ ¸å¿ƒæ¨¡å—
- ğŸ›¡ï¸ ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†
  - JWTä»¤ç‰Œè®¤è¯ï¼ˆ/tokenç«¯ç‚¹ï¼‰
  - å¤šçº§ç”¨æˆ·æƒé™ï¼ˆæ™®é€šç”¨æˆ·/è¶…çº§ç®¡ç†å‘˜ï¼‰
  - ç”¨æˆ·æ³¨å†Œå®¡æ ¸æœºåˆ¶ï¼ˆå¾…å®¡æ ¸/é€šè¿‡/æ‹’ç»çŠ¶æ€ï¼‰

- ğŸ“· è§†é¢‘è®¾å¤‡ç®¡ç†ï¼ˆRTSPæµæ¥å…¥ï¼‰
  - è®¾å¤‡å¢åˆ æ”¹æŸ¥æ¥å£
  - RTSPæµè¿é€šæ€§æ£€æµ‹
  - WebSocketå®æ—¶é¢„è§ˆï¼ˆ/ws/device-preview/{device_id}ï¼‰

- ğŸ§  ç®—æ³•æ¨¡å‹ç®¡ç†
  - æ”¯æŒYOLOv8æ¨¡å‹ä¸Šä¼ ä¸ç®¡ç†
  - æƒé‡æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
  - ç®—æ³•-ä»»åŠ¡ä¾èµ–å…³ç³»æ£€æŸ¥

- ğŸš¦ ä»»åŠ¡è°ƒåº¦ä¸ç›‘æ§
  - ä¸¤ç§ä»»åŠ¡ç±»å‹ï¼š
    - å®æ—¶ç›‘æ§ä»»åŠ¡ï¼ˆæŒç»­å¤„ç†RTSPæµï¼‰
    - æµ‹è¯•ä»»åŠ¡ï¼ˆå¤„ç†ä¸Šä¼ è§†é¢‘æ–‡ä»¶ï¼‰
  - ä»»åŠ¡çŠ¶æ€æœºç®¡ç†ï¼ˆstopped/running/errorï¼‰
  - è¿›ç¨‹çº§èµ„æºéš”ç¦»

- ğŸ”Œ å®æ—¶è§†é¢‘å¤„ç†
  - å¤šè¿›ç¨‹æ¶æ„ï¼ˆProcess + Queueï¼‰
  - å¸§çº§å¤„ç†æµæ°´çº¿ï¼š
    1. OpenCVå¸§æ•è·
    2. YOLOç›®æ ‡æ£€æµ‹
    3. ç»“æœå¯è§†åŒ–æ¸²æŸ“
    4. WebSocketå®æ—¶æ¨é€

### ç‰¹è‰²åŠŸèƒ½
- æ™ºèƒ½èµ„æºç®¡ç†
  - è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼ˆRTSPæµä¸­æ–­æ¢å¤ï¼‰
  - è¿›ç¨‹æ± ç®¡ç†ï¼ˆprocess_dict/queue_dictï¼‰
  - é˜Ÿåˆ—æº¢å‡ºä¿æŠ¤ï¼ˆmaxsize=30ï¼‰

- å¯è§†åŒ–æ”¯æŒ
  - å®æ—¶æ£€æµ‹æ¡†æ¸²æŸ“
  - å…³é”®å¸§ä¿å­˜ï¼ˆæ¯30å¸§å­˜å‚¨JPEGï¼‰
  - å¤„ç†æ—¥å¿—è¿½è¸ªï¼ˆ/tasks/{id}/logï¼‰

- å®‰å…¨æœºåˆ¶
  - WebSocketä»¤ç‰ŒéªŒè¯
  - æ•æ„Ÿæ“ä½œå®¡è®¡ï¼ˆç”¨æˆ·çŠ¶æ€å˜æ›´è®°å½•ï¼‰
  - æ–‡ä»¶æ²™ç®±å­˜å‚¨ï¼ˆéš”ç¦»weights/videos/resultsç›®å½•ï¼‰

- è¯Šæ–­å·¥å…·
  - è§†é¢‘æ–‡ä»¶æ ¡éªŒæ¥å£ï¼ˆ/results/{task_name}/check-videoï¼‰
  - å¤„ç†è¿›åº¦æŸ¥è¯¢ï¼ˆé€šè¿‡æ—¥å¿—æ–‡ä»¶ï¼‰
  - é”™è¯¯è¿½è¸ªï¼ˆè‡ªåŠ¨ç”Ÿæˆerror.txtï¼‰

## æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- FastAPI
- SQLAlchemy (å¼‚æ­¥)
- Pydantic
- JWTè®¤è¯

### è§†é¢‘å¤„ç†
- OpenCV
- YOLOv8
- å¤šè¿›ç¨‹å¤„ç†

### åŸºç¡€è®¾æ–½
- PostgreSQL
- Redisï¼ˆå¯é€‰ï¼‰
- Docker

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.9+
- PostgreSQL 12+
- OpenCV 4.7+
- FFmpeg

### å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/your-repo/stream-intellect-backend.git
cd stream-intellect-backend
```

2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

3. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```ini
DATABASE_URL=postgresql+asyncpg://user:password@localhost/dbname
SECRET_KEY=your-secret-key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

4. åˆå§‹åŒ–æ•°æ®åº“
```bash
python -m database.init_db
```

5. å¯åŠ¨æœåŠ¡
```bash
uvicorn backend.main:app --reload
```

## APIæ–‡æ¡£

è®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹äº¤äº’å¼APIæ–‡æ¡£ï¼ŒåŒ…å«ï¼š
- ç”¨æˆ·è®¤è¯æ¥å£
- è®¾å¤‡ç®¡ç†æ¥å£
- ç®—æ³•ç®¡ç†æ¥å£
- ä»»åŠ¡è°ƒåº¦æ¥å£
- WebSocketå®æ—¶æµæ¥å£

## ç³»ç»Ÿæ¶æ„

```mermaid
graph TD
    A[å®¢æˆ·ç«¯] --> B{NGINX}
    B --> C[è®¤è¯æœåŠ¡]
    B --> D[è§†é¢‘æµæœåŠ¡]
    C --> E[FastAPIåº”ç”¨]
    D --> F[è§†é¢‘å¤„ç†é›†ç¾¤]
    E --> G[(æ•°æ®åº“)]
    F --> H[å­˜å‚¨æœåŠ¡]
```

## å¼€å‘æŒ‡å—

### ä»£ç ç»“æ„
```
backend/
â”œâ”€â”€ main.py            # ä¸»å…¥å£
â”œâ”€â”€ database/          # æ•°æ®åº“æ¨¡å—
â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”œâ”€â”€ schemas/          # Pydanticæ¨¡å‹
â”œâ”€â”€ routes/           # APIè·¯ç”±
â””â”€â”€ utils/            # å·¥å…·ç±»
```

### è´¡çŒ®æµç¨‹
1. Forké¡¹ç›®ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/your-feature`)
3. æäº¤ä¿®æ”¹ (`git commit -m 'Add some feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/your-feature`)
5. åˆ›å»ºPull Request

## è®¸å¯è¯

[MIT License](LICENSE)

---

**æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®ä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå¹¶é…ç½®Nginxåå‘ä»£ç†å’ŒSSLè¯ä¹¦ã€‚
